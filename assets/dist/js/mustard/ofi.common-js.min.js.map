{"version":3,"sources":["ofi.common-js.js"],"names":["OFI","propRegex","testImg","Image","style","object-position","supportsObjectFit","supportsObjectPosition","supportsOFI","supportsCurrentSrc","currentSrc","nativeGetAttribute","getAttribute","nativeSetAttribute","setAttribute","autoModeEnabled","createPlaceholder","w","h","polyfillCurrentSrc","el","srcset","window","picturefill","pf","_","ns","evaled","fillImg","reselect","curSrc","supported","src","getStyle","parsed","getComputedStyle","fontFamily","props","exec","setPlaceholder","img","width","height","placeholder","call","onImageReady","callback","naturalWidth","setTimeout","fixOne","ofi","skipTest","naturalHeight","keepSrcUsable","err","console","warn","backgroundImage","replace","backgroundPosition","backgroundRepeat","backgroundOrigin","test","backgroundSize","descriptors","get","prop","set","value","Object","defineProperty","ss","hijackAttributes","getOfiImageMaybe","name","HTMLImageElement","prototype","this","String","fix","imgs","opts","startAutoMode","document","getElementsByTagName","querySelectorAll","i","length","body","addEventListener","e","target","tagName","watchMQ","bind","module","exports"],"mappings":"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","file":"ofi.common-js.min.js","sourcesContent":["/*! npm.im/object-fit-images 3.2.4 */\n'use strict';\n\nvar OFI = 'bfred-it:object-fit-images';\nvar propRegex = /(object-fit|object-position)\\s*:\\s*([-.\\w\\s%]+)/g;\nvar testImg = typeof Image === 'undefined' ? {style: {'object-position': 1}} : new Image();\nvar supportsObjectFit = 'object-fit' in testImg.style;\nvar supportsObjectPosition = 'object-position' in testImg.style;\nvar supportsOFI = 'background-size' in testImg.style;\nvar supportsCurrentSrc = typeof testImg.currentSrc === 'string';\nvar nativeGetAttribute = testImg.getAttribute;\nvar nativeSetAttribute = testImg.setAttribute;\nvar autoModeEnabled = false;\n\nfunction createPlaceholder(w, h) {\n\treturn (\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='\" + w + \"' height='\" + h + \"'%3E%3C/svg%3E\");\n}\n\nfunction polyfillCurrentSrc(el) {\n\tif (el.srcset && !supportsCurrentSrc && window.picturefill) {\n\t\tvar pf = window.picturefill._;\n\t\t// parse srcset with picturefill where currentSrc isn't available\n\t\tif (!el[pf.ns] || !el[pf.ns].evaled) {\n\t\t\t// force synchronous srcset parsing\n\t\t\tpf.fillImg(el, {reselect: true});\n\t\t}\n\n\t\tif (!el[pf.ns].curSrc) {\n\t\t\t// force picturefill to parse srcset\n\t\t\tel[pf.ns].supported = false;\n\t\t\tpf.fillImg(el, {reselect: true});\n\t\t}\n\n\t\t// retrieve parsed currentSrc, if any\n\t\tel.currentSrc = el[pf.ns].curSrc || el.src;\n\t}\n}\n\nfunction getStyle(el) {\n\tvar style = getComputedStyle(el).fontFamily;\n\tvar parsed;\n\tvar props = {};\n\twhile ((parsed = propRegex.exec(style)) !== null) {\n\t\tprops[parsed[1]] = parsed[2];\n\t}\n\treturn props;\n}\n\nfunction setPlaceholder(img, width, height) {\n\t// Default: fill width, no height\n\tvar placeholder = createPlaceholder(width || 1, height || 0);\n\n\t// Only set placeholder if it's different\n\tif (nativeGetAttribute.call(img, 'src') !== placeholder) {\n\t\tnativeSetAttribute.call(img, 'src', placeholder);\n\t}\n}\n\nfunction onImageReady(img, callback) {\n\t// naturalWidth is only available when the image headers are loaded,\n\t// this loop will poll it every 100ms.\n\tif (img.naturalWidth) {\n\t\tcallback(img);\n\t} else {\n\t\tsetTimeout(onImageReady, 100, img, callback);\n\t}\n}\n\nfunction fixOne(el) {\n\tvar style = getStyle(el);\n\tvar ofi = el[OFI];\n\tstyle['object-fit'] = style['object-fit'] || 'fill'; // default value\n\n\t// Avoid running where unnecessary, unless OFI had already done its deed\n\tif (!ofi.img) {\n\t\t// fill is the default behavior so no action is necessary\n\t\tif (style['object-fit'] === 'fill') {\n\t\t\treturn;\n\t\t}\n\n\t\t// Where object-fit is supported and object-position isn't (Safari < 10)\n\t\tif (\n\t\t\t!ofi.skipTest && // unless user wants to apply regardless of browser support\n\t\t\tsupportsObjectFit && // if browser already supports object-fit\n\t\t\t!style['object-position'] // unless object-position is used\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t}\n\n\t// keep a clone in memory while resetting the original to a blank\n\tif (!ofi.img) {\n\t\tofi.img = new Image(el.width, el.height);\n\t\tofi.img.srcset = nativeGetAttribute.call(el, \"data-ofi-srcset\") || el.srcset;\n\t\tofi.img.src = nativeGetAttribute.call(el, \"data-ofi-src\") || el.src;\n\n\t\t// preserve for any future cloneNode calls\n\t\t// https://github.com/bfred-it/object-fit-images/issues/53\n\t\tnativeSetAttribute.call(el, \"data-ofi-src\", el.src);\n\t\tif (el.srcset) {\n\t\t\tnativeSetAttribute.call(el, \"data-ofi-srcset\", el.srcset);\n\t\t}\n\n\t\tsetPlaceholder(el, el.naturalWidth || el.width, el.naturalHeight || el.height);\n\n\t\t// remove srcset because it overrides src\n\t\tif (el.srcset) {\n\t\t\tel.srcset = '';\n\t\t}\n\t\ttry {\n\t\t\tkeepSrcUsable(el);\n\t\t} catch (err) {\n\t\t\tif (window.console) {\n\t\t\t\tconsole.warn('https://bit.ly/ofi-old-browser');\n\t\t\t}\n\t\t}\n\t}\n\n\tpolyfillCurrentSrc(ofi.img);\n\n\tel.style.backgroundImage = \"url(\\\"\" + ((ofi.img.currentSrc || ofi.img.src).replace(/\"/g, '\\\\\"')) + \"\\\")\";\n\tel.style.backgroundPosition = style['object-position'] || 'center';\n\tel.style.backgroundRepeat = 'no-repeat';\n\tel.style.backgroundOrigin = 'content-box';\n\n\tif (/scale-down/.test(style['object-fit'])) {\n\t\tonImageReady(ofi.img, function () {\n\t\t\tif (ofi.img.naturalWidth > el.width || ofi.img.naturalHeight > el.height) {\n\t\t\t\tel.style.backgroundSize = 'contain';\n\t\t\t} else {\n\t\t\t\tel.style.backgroundSize = 'auto';\n\t\t\t}\n\t\t});\n\t} else {\n\t\tel.style.backgroundSize = style['object-fit'].replace('none', 'auto').replace('fill', '100% 100%');\n\t}\n\n\tonImageReady(ofi.img, function (img) {\n\t\tsetPlaceholder(el, img.naturalWidth, img.naturalHeight);\n\t});\n}\n\nfunction keepSrcUsable(el) {\n\tvar descriptors = {\n\t\tget: function get(prop) {\n\t\t\treturn el[OFI].img[prop ? prop : 'src'];\n\t\t},\n\t\tset: function set(value, prop) {\n\t\t\tel[OFI].img[prop ? prop : 'src'] = value;\n\t\t\tnativeSetAttribute.call(el, (\"data-ofi-\" + prop), value); // preserve for any future cloneNode\n\t\t\tfixOne(el);\n\t\t\treturn value;\n\t\t}\n\t};\n\tObject.defineProperty(el, 'src', descriptors);\n\tObject.defineProperty(el, 'currentSrc', {\n\t\tget: function () { return descriptors.get('currentSrc'); }\n\t});\n\tObject.defineProperty(el, 'srcset', {\n\t\tget: function () { return descriptors.get('srcset'); },\n\t\tset: function (ss) { return descriptors.set(ss, 'srcset'); }\n\t});\n}\n\nfunction hijackAttributes() {\n\tfunction getOfiImageMaybe(el, name) {\n\t\treturn el[OFI] && el[OFI].img && (name === 'src' || name === 'srcset') ? el[OFI].img : el;\n\t}\n\tif (!supportsObjectPosition) {\n\t\tHTMLImageElement.prototype.getAttribute = function (name) {\n\t\t\treturn nativeGetAttribute.call(getOfiImageMaybe(this, name), name);\n\t\t};\n\n\t\tHTMLImageElement.prototype.setAttribute = function (name, value) {\n\t\t\treturn nativeSetAttribute.call(getOfiImageMaybe(this, name), name, String(value));\n\t\t};\n\t}\n}\n\nfunction fix(imgs, opts) {\n\tvar startAutoMode = !autoModeEnabled && !imgs;\n\topts = opts || {};\n\timgs = imgs || 'img';\n\n\tif ((supportsObjectPosition && !opts.skipTest) || !supportsOFI) {\n\t\treturn false;\n\t}\n\n\t// use imgs as a selector or just select all images\n\tif (imgs === 'img') {\n\t\timgs = document.getElementsByTagName('img');\n\t} else if (typeof imgs === 'string') {\n\t\timgs = document.querySelectorAll(imgs);\n\t} else if (!('length' in imgs)) {\n\t\timgs = [imgs];\n\t}\n\n\t// apply fix to all\n\tfor (var i = 0; i < imgs.length; i++) {\n\t\timgs[i][OFI] = imgs[i][OFI] || {\n\t\t\tskipTest: opts.skipTest\n\t\t};\n\t\tfixOne(imgs[i]);\n\t}\n\n\tif (startAutoMode) {\n\t\tdocument.body.addEventListener('load', function (e) {\n\t\t\tif (e.target.tagName === 'IMG') {\n\t\t\t\tfix(e.target, {\n\t\t\t\t\tskipTest: opts.skipTest\n\t\t\t\t});\n\t\t\t}\n\t\t}, true);\n\t\tautoModeEnabled = true;\n\t\timgs = 'img'; // reset to a generic selector for watchMQ\n\t}\n\n\t// if requested, watch media queries for object-fit change\n\tif (opts.watchMQ) {\n\t\twindow.addEventListener('resize', fix.bind(null, imgs, {\n\t\t\tskipTest: opts.skipTest\n\t\t}));\n\t}\n}\n\nfix.supportsObjectFit = supportsObjectFit;\nfix.supportsObjectPosition = supportsObjectPosition;\n\nhijackAttributes();\n\nmodule.exports = fix;\n"]}